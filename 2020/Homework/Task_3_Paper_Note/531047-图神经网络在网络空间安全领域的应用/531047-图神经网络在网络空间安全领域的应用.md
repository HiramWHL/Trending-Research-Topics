# 图神经网络在网络空间安全领域的应用

> 作者：SCU@A2u13
>
> 年级：2017级 531047

## 图神经网络简介

​		传统的深度学习方法被应用在提取欧氏空间数据的特征方面取得了巨大的成功，但许多实际应用场景中的数据是从非欧式空间生成的，传统的深度学习方法在处理非欧式空间数据上的表现却仍难以使人满意。

​		近年来，人们对深度学习方法在图上的扩展越来越感兴趣。在多方因素的成功推动下，研究人员借鉴了卷积网络、循环网络和深度自动编码器的思想，定义和设计了用于处理图数据的神经网络结构，因此图神经网络（Graph Neural Networks，GNN）应运而生。

​		图神经网络是一种从卷积神经网络和图嵌入思想演变而来的新型神经网络，它可以对于图数据进行特征提取和表示，在学习图数据方面表现出很好的性能，是一种高效的、易于扩展的神经网络结构。图神经网络是利用一定的方法对节点进行描述，并经过不断的节点状态更新，得到具有包含邻居节点信息和图形拓扑结构特点的状态，最终将这些节点通过特定方法进行输出，得到需要的结果。图神经网络是用于图结构数据的深度学习架构，将端到端学习与归纳推理相结合，业界普遍认为其有望解决深度学习无法处理的因果推理、可解释性等一系列瓶颈问题，是未来 3 到 5 年的重点方向。

## 漏洞发现中的应用

​		图神经网络（GNN）将图论与深度学习相结合，突破了神经网络只能作用在欧式数据（Euclidean data）上的限制，把神经网络强大的特征提取能力扩展到非欧数据（non-Euclidean data）上。

​	GNN 的第一个动机源于卷积神经网络（CNN）。CNN 的广泛应用带来了机器学习领域的突破并开启了深度学习的新时代。然而 CNN 只能在规则的 Euclidean 数据上运行，如图像（2 维网格）和文本（1 维序列）。如何将 CNN 应用于图结构这一非欧几里德空间，成为 GNN 模型重点解决的问题。

​	GNN 的另一个动机来自图嵌入（Graph Embedding），它学习图中节点、边或子图的低维向量空间表示。DeepWalk、LINE、SDNE 等方法在网络表示学习领域取得了很大的成功。然而，这些方法在计算上较为复杂并且在大规模上的图上并不是最优，GNN 旨在解决这些问题。

![image-20200524132840882](https://a2u13-pic.oss-cn-chengdu.aliyuncs.com/pic/image-20200524132840882.png)

图嵌入网络只能获得单个图的表征，在比较的过程中，没有结合另一个图的信息，为此使用新的图匹配网络（GMN），给定两个图，图匹配网络计算它们的相似度。

![image-20200524133206696](https://a2u13-pic.oss-cn-chengdu.aliyuncs.com/pic/image-20200524133206696.png)

GMN结构：

1.准备节点向量（通过全连接神经网络到每一个节点的向量表征）

2.使用图卷积神经网络进行消息传播L个步骤，以得到包含图结构的节点表征

3.在每个传播步骤的每个节点上，基于节点矢量相似度添加另一个图的节点矢量的加权和

4.使用全连接神经网络聚合节点向量

5.输出图向量之间的相似性度量


![image-20200524132923536](https://a2u13-pic.oss-cn-chengdu.aliyuncs.com/pic/image-20200524132923536.png)

## 二进制相似度检测

二进制代码相似性检测，其目的是在无需访问源代码的情况下检测相似的二进制函数，是计算机安全中的一项基本任务。传统方法通常使用图匹配算法，该算法比较慢和不准确，为此提出了利用图神经网络来进行二进制代码相似检测。

**过程**

1. 首先将二进制函数表示为具有手动选择的功能块的控制流图（CFG），然后将其表示为图神经网络（GNN）用于计算图嵌入。

2. 我们提出了语义感知神经网络来提取二进制代码的语义信息，在语义学习模型中，采用了带MLM和ANP的BERT来与训练词嵌入和块嵌入。
3. 在顺序感知模型中，在邻接矩阵上使用CNN来提取控制流程图的节点顺序信息。
4. 使用四个数据集进行训练，得到结果模型优于以前的模型

![image-20200524134009377](https://a2u13-pic.oss-cn-chengdu.aliyuncs.com/pic/image-20200524134009377.png)

该模型包含三个组件：语义感知模块，结构感知模块和命令感知模块

> 在语义感知模块，模型将控制流图作为输入，使用BERT对token embedding作预训练，得到block embedding。
>
> 在结构感知模块，使用MPNN算法得到graph semantic & structural embedding。
>
> 在命令感知模块，模型将控制流图的邻接矩阵作为输入，并使用CNN计算graph order embedding。最后对两个向量使用concat和MLP得到最终的graph embedding

## 恶意账户识别

​		在恶意账户检测领域，来自蚂蚁金服的安全研究团队一直在致力于不断采用新技术提高其检测效率，并最终在CIKM 2018会议中提出了GEM模型。

​		该模型首次提出了采用异质图神经网络方法，在支付宝应用中检测恶意账户，经实验验证，该基于图神经网络的新检测方法较传统基于规则与基于机器学习的手段明显提高了检测效率。

该方法主要针对恶意账户拥有的两个特征：即设备聚集性和时间聚集性。

- **设备聚集性**

  > 指攻击者要考虑计算资源带来的成本，故大多数攻击者只在少数计算资源上注册或频繁地登录。如果一个帐户注册或登录同一个（一组）设备或一组公共设备，若这一个（一组）设备上有大量其他账户，那么此类帐户将是可疑的。

- **时间聚集性**

  > 指攻击者通常会在短时间内完成既定目标，所以恶意账户的行为可能在有限的时间内集中进行。如果共享设备的账户行为是批量进行的，那么这些账户是可疑的。

该方法受连通子图方法的启发并在此基础上进行扩展：

- 第一：构建异构图，包括账户类节点，以及多种类型的设备信息，如：电话、MAC、IMSI 以及其他 ID。
- 第二：为每个账户加入时间上的行为特征。其中每行表示节点（账户或设备）在时间上的行为特征。
- 第三：图构建好后再根据时间间隔等因素去除噪声（除边），然后取其连通子图，即为若干相关用户组。
- 第四：对于每个用户组，捕捉组内用户行为并为每个用户构造行为矩阵，然后引入注意力机制并使用GCN对其进行优化训练，最终判定组内节点是否为恶意用户。

​		GEM模型本质上是对异质的用户设备图进行建模，同时考虑了异质图中的来自攻击者的设备聚集特征与行为聚集特征，针对设备聚集特征，其计算连通子图的规模，衡量账户的风险；针对行为聚集特征，其使用向量内积来度量两个账户关联性，并用于对连通子图进行进一步分割。此外，GEM从该异质图中自适应学习图嵌入，并使用注意力机制，在学习过程中自适应地为不同类型的子图分配注意力。

